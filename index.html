<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨æ–¹ä½ç”Ÿè©å­¸ç¿’ä¸­å¿ƒ - ç¬¬ä¸‰èª²</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; touch-action: manipulation; }
        .screen { display: none; }
        .main-menu-btn { transition: all 0.2s ease-in-out; }
        .main-menu-btn:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        
        /* Flashcard Styles */
        .flashcard-container { perspective: 1000px; }
        .flashcard-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .flashcard-container.is-flipped .flashcard-inner { transform: rotateY(180deg); }
        .flashcard-front, .flashcard-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 1.5rem; border-radius: 1.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); overflow-y: auto; }
        .flashcard-front { background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); color: #0c4a6e; }
        .flashcard-back { background: linear-gradient(135deg, #fefce8 0%, #fffbeb 100%); color: #713f12; transform: rotateY(180deg); }
        
        /* Matching Game Styles */
        .match-item { transition: all 0.5s ease-in-out; cursor: pointer; border: 2px solid #cbd5e1; }
        .match-item:hover { background-color: #f1f5f9; border-color: #94a3b8; }
        .match-item.selected { background-color: #bae6fd; border-color: #38bdf8; transform: scale(1.05); }
        /* --- UPDATED ---: This class now controls the disappearing animation */
        .match-item.matched { 
            opacity: 0;
            transform: scale(0.9);
            height: 0;
            padding-top: 0;
            padding-bottom: 0;
            margin-top: -2px; /* to compensate border */
            margin-bottom: 0;
            border-width: 0;
            pointer-events: none;
        }
        .match-item.incorrect { background-color: #fee2e2; border-color: #f87171; animation: shake 0.5s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        /* Memory Game Styles */
        .memory-card { perspective: 1000px; cursor: pointer; }
        .memory-card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.5s; transform-style: preserve-3d; }
        .memory-card.is-flipped .memory-card-inner { transform: rotateY(180deg); }
        .memory-card-front, .memory-card-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; justify-content: center; align-items: center; border-radius: 0.75rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .memory-card-front { background: linear-gradient(135deg, #60a5fa, #3b82f6); color: white; font-size: 2rem; }
        .memory-card-back { background-color: #f1f5f9; transform: rotateY(180deg); padding: 8px; font-size: 0.9rem; text-align: center; }
        .memory-card.matched { opacity: 0; transform: scale(0); transition: all 0.5s; }
    </style>
</head>
<body class="bg-slate-100 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-3xl mx-auto">
        
        <!-- Main Menu Screen -->
        <div id="screen-menu" class="screen" style="display: block;">
            <div class="text-center mb-8">
                <h1 class="text-3xl sm:text-4xl font-bold text-sky-800">å…¨æ–¹ä½ç”Ÿè©å­¸ç¿’ä¸­å¿ƒ</h1>
                <p class="text-slate-500 mt-2">ç¬¬ä¸‰èª² è«‡é‡è¦‹æ›´å¥½çš„è‡ªå·±</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
                <button onclick="startMode('flashcard-word')" class="main-menu-btn bg-white p-6 rounded-xl shadow-md text-left">
                    <h2 class="text-xl font-bold text-slate-800">ğŸ“– é–ƒå¡ç·´ç¿’</h2>
                    <p class="text-slate-500 mt-1">çœ‹è©èªï¼Œå›æƒ³è§£é‡‹å’Œé€ å¥ã€‚</p>
                </button>
                <button onclick="startMode('flashcard-def')" class="main-menu-btn bg-white p-6 rounded-xl shadow-md text-left">
                    <h2 class="text-xl font-bold text-slate-800">ğŸ¤” åå‘é–ƒå¡</h2>
                    <p class="text-slate-500 mt-1">çœ‹è§£é‡‹ï¼Œå›æƒ³æ­£ç¢ºçš„è©èªã€‚</p>
                </button>
                <button onclick="startMode('matching')" class="main-menu-btn bg-white p-6 rounded-xl shadow-md text-left">
                    <h2 class="text-xl font-bold text-slate-800">ğŸ”— é…å°éŠæˆ²</h2>
                    <p class="text-slate-500 mt-1">å°‡è©èªå’Œå°æ‡‰çš„è§£é‡‹é€£èµ·ä¾†ï¼</p>
                </button>
                <button onclick="startMode('memory')" class="main-menu-btn bg-white p-6 rounded-xl shadow-md text-left">
                    <h2 class="text-xl font-bold text-slate-800">ğŸ§  è¨˜æ†¶éŠæˆ²</h2>
                    <p class="text-slate-500 mt-1">ç¿»é–‹å¡ç‰Œï¼Œæ‰¾å‡ºæ‰€æœ‰é…å°ã€‚</p>
                </button>
                <button onclick="startMode('quiz')" class="main-menu-btn bg-white p-6 rounded-xl shadow-md text-left md:col-span-2">
                    <h2 class="text-xl font-bold text-slate-800">âœï¸ ç¶œåˆæ¸¬é©—</h2>
                    <p class="text-slate-500 mt-1">é€éå¡«ç©ºé¡Œï¼Œæª¢é©—ä½ çš„å­¸ç¿’æˆæœã€‚</p>
                </button>
            </div>
        </div>

        <!-- Universal Header for modes -->
        <div id="mode-header" class="hidden items-center mb-4">
            <button onclick="showScreen('menu')" class="bg-white text-slate-600 px-4 py-2 rounded-lg shadow-sm hover:bg-slate-100">è¿”å›ä¸»é¸å–®</button>
            <h2 id="mode-title" class="text-xl font-bold text-sky-800 mx-auto"></h2>
            <div class="w-24"></div> <!-- Placeholder for centering title -->
        </div>

        <!-- Flashcard Screen -->
        <div id="screen-flashcard" class="screen">
            <div class="flashcard-container w-full h-80 sm:h-96 mb-6 cursor-pointer" onclick="this.classList.toggle('is-flipped')">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <p id="flashcard-front-text" class="text-4xl md:text-6xl font-bold text-center"></p>
                    </div>
                    <div class="flashcard-back">
                        <div id="flashcard-back-content" class="text-center">
                             <h3 id="flashcard-back-title" class="text-2xl md:text-3xl font-bold mb-4"></h3>
                             <p id="flashcard-back-def" class="text-base md:text-lg whitespace-pre-line mb-4"></p>
                             <p id="flashcard-back-sentence" class="text-base md:text-lg whitespace-pre-line text-amber-700"></p>
                        </div>
                    </div>
                </div>
            </div>
             <div class="flex justify-between items-center">
                <button id="flashcard-prev" class="bg-white py-3 px-6 rounded-full shadow-md">ä¸Šä¸€å€‹</button>
                <div id="flashcard-progress" class="text-slate-600"></div>
                <button id="flashcard-next" class="bg-sky-600 text-white font-bold py-3 px-6 rounded-full shadow-lg">ä¸‹ä¸€å€‹</button>
            </div>
        </div>

        <!-- Matching Game Screen -->
        <div id="screen-matching" class="screen">
             <p id="matching-status" class="text-center text-slate-600 mb-4 h-6"></p>
             <div class="grid grid-cols-2 gap-4">
                 <div id="matching-col-1" class="space-y-3"></div>
                 <div id="matching-col-2" class="space-y-3"></div>
             </div>
        </div>

        <!-- Memory Game Screen -->
        <div id="screen-memory" class="screen">
             <div class="flex justify-between items-center mb-4">
                <p class="text-slate-600">å·²æ‰¾åˆ°é…å°: <span id="memory-found">0</span> / <span id="memory-total"></span></p>
                <p class="text-slate-600">æ­¥æ•¸: <span id="memory-moves">0</span></p>
            </div>
            <div id="memory-grid" class="grid grid-cols-4 gap-2 sm:gap-3"></div>
        </div>

        <!-- Quiz Screen -->
        <div id="screen-quiz" class="screen bg-white p-6 sm:p-8 rounded-2xl shadow-lg">
            <!-- Quiz content will be injected here -->
        </div>
        
    </div>

<script>
// --- VOCABULARY DATA ---
const vocabulary = [
    { word: "æ­ç¤º", definition: "æ­éœ²ã€å…¬å¸ƒã€‚", sentence: "é€™èµ·äº‹ä»¶æ·±åˆ»______äº†æ€§åˆ¥å¹³ç­‰çš„é‡è¦ã€‚" },
    { word: "å“è¶Š", definition: "éå¸¸å„ªç§€ï¼Œè¶…ä¹å¸¸äººã€‚", sentence: "ä»–çš„é ˜å°æ‰èƒ½______ï¼Œé —å—ä¸»ç®¡é‡è¦–ã€‚" },
    { word: "åŸ¹é¤Š", definition: "é•·æœŸç­–ç•«å’Œè¨“ç·´ã€‚", sentence: "ä½œæ–‡èƒ½åŠ›çš„______ï¼Œå¯å¾å¤šçœ‹ã€å¤šè®€ã€å¤šå¯«ä¸‰æ–¹é¢è‘—æ‰‹ã€‚" },
    { word: "ç¸½è£", definition: "éŠ€è¡Œæˆ–è²¡åœ˜çš„æœ€é«˜è¡Œæ”¿è² è²¬äººã€‚", sentence: "ç¸½å…¬å¸å®£å¸ƒï¼Œæ˜å¹´åº¦å°‡ä»»å‘½ä»–ç‚ºæ–°ä¸€ä»»______ã€‚" },
    { word: "ç‘£äº‹", definition: "ç´°å°é›¶ç¢çš„äº‹æƒ…ã€‚", sentence: "ä»–åŸæœ¬æœˆåº•è¦å‡ºåœ‹æ—…éŠï¼Œå› ç‚º______çºèº«ï¼Œæ‰€ä»¥æš«ç·©è¨ˆç•«ã€‚" },
    { word: "æ–¹ä»²æ°¸", definition: "æŒ‡å¤©è³‡è°ç©ä½†å¾Œå¤©æœªåŠªåŠ›è€Œè‡´å¹³åº¸çš„äººã€‚", sentence: "______çš„æ•…äº‹å‘Šè¨´æˆ‘å€‘ï¼Œå¤©è³‡å†é«˜ï¼Œä¹Ÿéœ€è¦å¾Œå¤©çš„å­¸ç¿’æ‰èƒ½ç²¾é€²ã€‚" },
    { word: "è€•ç”°", definition: "æ³›æŒ‡è€•ç¨®ç”°åœ°çš„ä¸€åˆ‡æ´»å‹•ã€‚", sentence: "é›–ç„¶è±”é™½é«˜ç…§ï¼Œè¾²å¤«ä»ç„¶ä¸è¾­è¾›è‹¦çš„åœ¨ç”°è£¡______ã€‚" },
    { word: "è³ºéŒ¢", definition: "è³ºå–è²¡åˆ©ã€‚", sentence: "æˆ‘å€‘ä¸€æ—¦æ­¥å…¥ç¤¾æœƒï¼Œå°±æœƒçŸ¥é“______çš„è¾›è‹¦ã€‚" },
    { word: "è°ç©", definition: "éå¸¸è°æ˜ã€‚", sentence: "å¼Ÿå¼Ÿæ—¢______åˆç”¨åŠŸï¼Œæˆç¸¾ç›¸ç•¶å‡ºè‰²ã€‚" },
    { word: "æƒ‹æƒœ", definition: "å˜†æƒœã€ä»¤äººæ„Ÿè¦ºå¯æƒœã€‚", sentence: "é€™éº¼è°æ˜çš„äººç«Ÿèª¤å…¥æ­§é€”ï¼Œä¸å…ä»¤äºº______ã€‚" },
    { word: "æ¬ ç¼º", definition: "çŸ­å°‘ã€ä¸å¤ ã€‚", sentence: "é€™å®¶å…¬å¸å› ______è³‡é‡‘å°è‡´å‘¨è½‰ä¸éˆï¼Œå·²å®£å‘Šç ´ç”¢ã€‚" },
    { word: "é©•å‚²è‡ªæ»¿", definition: "è‡ªä»¥ç‚ºäº†ä¸èµ·è€Œå‚²æ…¢è‡ªå¤§ã€‚", sentence: "æˆ‘å€‘ä¸èƒ½å› ç‚ºæœ‰ä¸€é»é»æˆå°±è€Œ______ã€‚" },
    { word: "æ˜¨å¤©", definition: "å‰ä¸€æ—¥ã€‚", sentence: "ä»–å› ç‚º______é€£å¤œè¶•å ±å‘Šï¼Œç¾åœ¨ç´¯å¾—å‘¼å‘¼å¤§ç¡ã€‚" },
    { word: "è€•è€˜", definition: "æ¯”å–»ä»˜å‡ºç²¾ç¥å’Œå‹åŠ›ã€‚", sentence: "ä¸€åˆ†______ï¼Œä¸€åˆ†æ”¶ç©«ã€‚" },
    { word: "èŒå£¯", definition: "æˆé•·å£¯å¤§ã€‚", sentence: "å«©è‹—è¦ç¶“éç´°å¿ƒå‘µè­·ï¼Œæ‰èƒ½æˆé•·______ã€‚" }
];
const fullSentences = [
    "é€™èµ·äº‹ä»¶æ·±åˆ»æ­ç¤ºäº†æ€§åˆ¥å¹³ç­‰çš„é‡è¦ã€‚",
    "ä»–çš„é ˜å°æ‰èƒ½å“è¶Šï¼Œé —å—ä¸»ç®¡é‡è¦–ã€‚",
    "ä½œæ–‡èƒ½åŠ›çš„åŸ¹é¤Šï¼Œå¯å¾å¤šçœ‹ã€å¤šè®€ã€å¤šå¯«ä¸‰æ–¹é¢è‘—æ‰‹ã€‚",
    "ç¸½å…¬å¸å®£å¸ƒï¼Œæ˜å¹´åº¦å°‡ä»»å‘½ä»–ç‚ºæ–°ä¸€ä»»ç¸½è£ã€‚",
    "ä»–åŸæœ¬æœˆåº•è¦å‡ºåœ‹æ—…éŠï¼Œå› ç‚ºç‘£äº‹çºèº«ï¼Œæ‰€ä»¥æš«ç·©è¨ˆç•«ã€‚",
    "æ–¹ä»²æ°¸çš„æ•…äº‹å‘Šè¨´æˆ‘å€‘ï¼Œå¤©è³‡å†é«˜ï¼Œä¹Ÿéœ€è¦å¾Œå¤©çš„å­¸ç¿’æ‰èƒ½ç²¾é€²ã€‚",
    "é›–ç„¶è±”é™½é«˜ç…§ï¼Œè¾²å¤«ä»ç„¶ä¸è¾­è¾›è‹¦çš„åœ¨ç”°è£¡è€•ç¨®ã€‚",
    "æˆ‘å€‘ä¸€æ—¦æ­¥å…¥ç¤¾æœƒï¼Œå°±æœƒçŸ¥é“è³ºéŒ¢çš„è¾›è‹¦ã€‚",
    "å¼Ÿå¼Ÿæ—¢è°ç©åˆç”¨åŠŸï¼Œæˆç¸¾ç›¸ç•¶å‡ºè‰²ã€‚",
    "é€™éº¼è°æ˜çš„äººç«Ÿèª¤å…¥æ­§é€”ï¼Œä¸å…ä»¤äººæƒ‹æƒœã€‚",
    "é€™å®¶å…¬å¸å› æ¬ ç¼ºè³‡é‡‘å°è‡´å‘¨è½‰ä¸éˆï¼Œå·²å®£å‘Šç ´ç”¢ã€‚",
    "æˆ‘å€‘ä¸èƒ½å› ç‚ºæœ‰ä¸€é»é»æˆå°±è€Œé©•å‚²è‡ªæ»¿ã€‚",
    "ä»–å› ç‚ºæ˜¨å¤©é€£å¤œè¶•å ±å‘Šï¼Œç¾åœ¨ç´¯å¾—å‘¼å‘¼å¤§ç¡ã€‚",
    "ä¸€åˆ†è€•è€˜ï¼Œä¸€åˆ†æ”¶ç©«ã€‚",
    "å«©è‹—è¦ç¶“éç´°å¿ƒå‘µè­·ï¼Œæ‰èƒ½æˆé•·èŒå£¯ã€‚"
];


// --- UTILS ---
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

const allScreens = document.querySelectorAll('.screen');
const modeHeader = document.getElementById('mode-header');
const modeTitle = document.getElementById('mode-title');

function showScreen(screenId) {
    allScreens.forEach(s => s.style.display = 'none');
    modeHeader.style.display = 'none';

    if (screenId === 'menu') {
        document.getElementById('screen-menu').style.display = 'block';
    } else {
        modeHeader.style.display = 'flex';
        document.getElementById(`screen-${screenId}`).style.display = 'block';
    }
}

function startMode(mode) {
    const titles = {
        'flashcard-word': 'é–ƒå¡ç·´ç¿’ (çœ‹è©èª)',
        'flashcard-def': 'åå‘é–ƒå¡ (çœ‹è§£é‡‹)',
        'matching': 'é…å°éŠæˆ²',
        'memory': 'è¨˜æ†¶éŠæˆ²',
        'quiz': 'ç¶œåˆæ¸¬é©—'
    };
    modeTitle.textContent = titles[mode];
    
    if (mode.startsWith('flashcard')) {
        initFlashcards(mode === 'flashcard-word');
        showScreen('flashcard');
    } else if (mode === 'matching') {
        initMatchingGame();
        showScreen('matching');
    } else if (mode === 'memory') {
        initMemoryGame();
        showScreen('memory');
    } else if (mode === 'quiz') {
        initQuiz(vocabulary);
        showScreen('quiz');
    }
}

// --- FLASHCARD LOGIC ---
let flashcardIndex = 0;
let isWordFront = true;
const flashcardContainer = document.querySelector('.flashcard-container');
const fcFrontText = document.getElementById('flashcard-front-text');
const fcBackTitle = document.getElementById('flashcard-back-title');
const fcBackDef = document.getElementById('flashcard-back-def');
const fcBackSentence = document.getElementById('flashcard-back-sentence');
const fcProgress = document.getElementById('flashcard-progress');

function initFlashcards(wordIsFront) {
    flashcardIndex = 0;
    isWordFront = wordIsFront;
    shuffleArray(vocabulary);
    updateFlashcard();
}

function updateFlashcard() {
    const card = vocabulary[flashcardIndex];
    const originalIndex = vocabulary.findIndex(v => v.word === card.word);
    if (isWordFront) {
        fcFrontText.textContent = card.word;
        fcBackTitle.textContent = card.word;
        fcBackDef.textContent = card.definition;
        fcBackSentence.textContent = `ä¾‹å¥ï¼š${fullSentences[originalIndex]}`;
    } else {
        fcFrontText.textContent = card.definition;
        fcBackTitle.textContent = card.word;
        fcBackDef.textContent = card.definition;
        fcBackSentence.textContent = `ä¾‹å¥ï¼š${fullSentences[originalIndex]}`;
    }
    fcProgress.textContent = `${flashcardIndex + 1} / ${vocabulary.length}`;
    flashcardContainer.classList.remove('is-flipped');
}

document.getElementById('flashcard-next').addEventListener('click', () => {
    flashcardIndex = (flashcardIndex + 1) % vocabulary.length;
    updateFlashcard();
});
document.getElementById('flashcard-prev').addEventListener('click', () => {
    flashcardIndex = (flashcardIndex - 1 + vocabulary.length) % vocabulary.length;
    updateFlashcard();
});


// --- MATCHING GAME LOGIC ---
let selectedWord = null, selectedDef = null;
let matchedCount = 0;
const matchingCol1 = document.getElementById('matching-col-1');
const matchingCol2 = document.getElementById('matching-col-2');
const matchingStatus = document.getElementById('matching-status');

function initMatchingGame() {
    matchingCol1.innerHTML = '';
    matchingCol2.innerHTML = '';
    selectedWord = null;
    selectedDef = null;
    matchedCount = 0;
    matchingStatus.textContent = `å·²é…å°: 0 / ${vocabulary.length}`;

    const words = shuffleArray([...vocabulary]);
    const defs = shuffleArray([...vocabulary]);

    words.forEach(item => {
        const div = document.createElement('div');
        div.textContent = item.word;
        div.dataset.word = item.word;
        div.className = 'match-item p-4 rounded-lg text-center';
        div.onclick = () => selectMatchItem(div, 'word');
        matchingCol1.appendChild(div);
    });

    defs.forEach(item => {
        const div = document.createElement('div');
        div.textContent = item.definition;
        div.dataset.word = item.word;
        div.className = 'match-item p-4 rounded-lg text-center';
        div.onclick = () => selectMatchItem(div, 'def');
        matchingCol2.appendChild(div);
    });
}

function selectMatchItem(element, type) {
    if (element.classList.contains('matched')) return;

    if (type === 'word') {
        if (selectedWord) selectedWord.classList.remove('selected');
        selectedWord = element;
        selectedWord.classList.add('selected');
    } else {
        if (selectedDef) selectedDef.classList.remove('selected');
        selectedDef = element;
        selectedDef.classList.add('selected');
    }

    if (selectedWord && selectedDef) {
        if (selectedWord.dataset.word === selectedDef.dataset.word) {
            selectedWord.classList.add('matched');
            selectedDef.classList.add('matched');
            selectedWord.classList.remove('selected');
            selectedDef.classList.remove('selected');
            selectedWord = null;
            selectedDef = null;
            matchedCount++;
            matchingStatus.textContent = `å·²é…å°: ${matchedCount} / ${vocabulary.length}`;
            if (matchedCount === vocabulary.length) {
                matchingStatus.textContent = 'æ­å–œï¼å…¨éƒ¨é…å°æˆåŠŸï¼';
            }
        } else {
            selectedWord.classList.add('incorrect');
            selectedDef.classList.add('incorrect');
            setTimeout(() => {
                if (selectedWord) selectedWord.classList.remove('incorrect', 'selected');
                if (selectedDef) selectedDef.classList.remove('incorrect', 'selected');
                selectedWord = null;
                selectedDef = null;
            }, 500);
        }
    }
}


// --- MEMORY GAME LOGIC ---
let flippedCards = [];
let moves = 0;
let memoryMatchedCount = 0;
let memoryGameVocab = [];
const memoryGrid = document.getElementById('memory-grid');

function initMemoryGame() {
    memoryGrid.innerHTML = '';
    moves = 0;
    memoryMatchedCount = 0;
    flippedCards = [];

    // --- UPDATED ---: Select 8 random words for the game
    memoryGameVocab = shuffleArray([...vocabulary]).slice(0, 8);

    document.getElementById('memory-moves').textContent = 0;
    document.getElementById('memory-found').textContent = 0;
    document.getElementById('memory-total').textContent = memoryGameVocab.length;

    let cardsData = [];
    memoryGameVocab.forEach(item => {
        cardsData.push({ type: 'word', content: item.word, matchId: item.word });
        cardsData.push({ type: 'def', content: item.definition, matchId: item.word });
    });
    shuffleArray(cardsData);

    cardsData.forEach(data => {
        const card = document.createElement('div');
        card.className = 'memory-card h-24';
        card.dataset.matchId = data.matchId;
        card.innerHTML = `
            <div class="memory-card-inner">
                <div class="memory-card-front">?</div>
                <div class="memory-card-back">${data.content}</div>
            </div>
        `;
        card.addEventListener('click', () => flipMemoryCard(card));
        memoryGrid.appendChild(card);
    });
}

function flipMemoryCard(card) {
    if (flippedCards.length < 2 && !card.classList.contains('is-flipped') && !card.classList.contains('matched')) {
        card.classList.add('is-flipped');
        flippedCards.push(card);

        if (flippedCards.length === 2) {
            moves++;
            document.getElementById('memory-moves').textContent = moves;
            checkMemoryMatch();
        }
    }
}

function checkMemoryMatch() {
    const [card1, card2] = flippedCards;
    if (card1.dataset.matchId === card2.dataset.matchId) {
        setTimeout(() => {
            card1.classList.add('matched');
            card2.classList.add('matched');
            memoryMatchedCount++;
            document.getElementById('memory-found').textContent = memoryMatchedCount;
            if(memoryMatchedCount === memoryGameVocab.length) {
                // Game over, maybe show a message
            }
        }, 500);
    } else {
        setTimeout(() => {
            card1.classList.remove('is-flipped');
            card2.classList.remove('is-flipped');
        }, 1000);
    }
    setTimeout(() => { flippedCards = []; }, 1000);
}


// --- QUIZ LOGIC ---
const quizScreen = document.getElementById('screen-quiz');
let quizQuestions = [];
let currentQuizIndex = 0;
let score = 0;
let incorrectAnswers = [];

function initQuiz(questionsData) {
    currentQuizIndex = 0;
    score = 0;
    incorrectAnswers = [];
    
    let tempQuestionsData = [...questionsData]; // Create a mutable copy

    quizQuestions = tempQuestionsData.map(item => {
        const otherWords = vocabulary.filter(v => v.word !== item.word).map(v => v.word);
        shuffleArray(otherWords);
        const distractors = otherWords.slice(0, 3);
        const options = [item.word, ...distractors];
        shuffleArray(options);
        return {
            original: item, // Store original item
            text: item.sentence,
            options: options,
            correctAnswer: item.word
        };
    });
    shuffleArray(quizQuestions);
    
    displayQuizQuestion();
}

function displayQuizQuestion() {
    if (currentQuizIndex >= quizQuestions.length) {
        displayQuizResults();
        return;
    }
    
    const question = quizQuestions[currentQuizIndex];
    const progress = (currentQuizIndex / quizQuestions.length) * 100;

    quizScreen.innerHTML = `
        <header class="mb-6">
            <div class="flex justify-between items-center mb-2">
                <h1 class="text-xl sm:text-2xl font-bold text-sky-800">ç”Ÿè©ç†è§£æ¸¬é©—</h1>
                <div class="text-sm font-medium text-slate-500">å•é¡Œ ${currentQuizIndex + 1} / ${quizQuestions.length}</div>
            </div>
            <div class="w-full bg-slate-200 rounded-full h-2.5">
                <div class="bg-sky-600 h-2.5 rounded-full transition-all duration-300" style="width: ${progress}%"></div>
            </div>
        </header>
        <main>
            <div class="bg-slate-100 p-4 sm:p-6 rounded-lg mb-6">
               <p class="text-lg sm:text-xl text-center font-medium h-24 flex items-center justify-center">${question.text}</p>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                ${question.options.map(opt => `<button class="quiz-option-btn w-full p-4 border-2 border-slate-300 rounded-lg text-lg bg-white hover:bg-sky-100 hover:border-sky-400" onclick="selectQuizAnswer(this, '${opt}', '${question.correctAnswer}')">${opt}</button>`).join('')}
            </div>
            <div class="mt-4 text-center h-6">
                 <p id="quiz-feedback" class="font-bold"></p>
            </div>
            <div class="mt-6 text-center">
                <button id="quiz-next-btn" class="hidden w-full sm:w-auto bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 px-12 rounded-full shadow-lg" onclick="nextQuizQuestion()">
                    ä¸‹ä¸€é¡Œ
                </button>
            </div>
        </main>
    `;
}

function selectQuizAnswer(btn, selected, correct) {
    document.querySelectorAll('.quiz-option-btn').forEach(b => {
        b.disabled = true;
        if (b.textContent === correct) b.classList.add('!bg-green-500', '!text-white', '!border-green-600');
    });

    if (selected === correct) {
        score++;
        document.getElementById('quiz-feedback').textContent = 'ç­”å°äº†ï¼';
        document.getElementById('quiz-feedback').className = 'font-bold text-green-600';
    } else {
        btn.classList.add('!bg-red-500', '!text-white', '!border-red-600');
        document.getElementById('quiz-feedback').textContent = `ç­”éŒ¯äº†ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${correct}`;
        document.getElementById('quiz-feedback').className = 'font-bold text-red-600';
        // Ensure we don't add duplicates to incorrectAnswers
        if (!incorrectAnswers.some(item => item.word === quizQuestions[currentQuizIndex].original.word)) {
            incorrectAnswers.push(quizQuestions[currentQuizIndex].original);
        }
    }
    document.getElementById('quiz-next-btn').style.display = 'inline-block';
}

function nextQuizQuestion() {
    currentQuizIndex++;
    displayQuizQuestion();
}

function displayQuizResults() {
    const percentage = quizQuestions.length > 0 ? (score / quizQuestions.length) * 100 : 100;
    let message = '';
    if (percentage === 100) message = 'å¤ªæ£’äº†ï¼å…¨éƒ¨ç­”å°ï¼Œä½ çœŸæ˜¯å€‹è©èªå¤§å¸«ï¼';
    else if (percentage >= 80) message = 'è¡¨ç¾å„ªç•°ï¼ç¹¼çºŒåŠªåŠ›ã€‚';
    else if (percentage >= 60) message = 'é‚„ä¸éŒ¯ï¼å°æ–¼ä¸ç†Ÿæ‚‰çš„è©èªå¯ä»¥å¤šç·´ç¿’å¹¾æ¬¡ã€‚';
    else message = 'åˆ¥ç°å¿ƒï¼Œå¤šç·´ç¿’å¹¾æ¬¡å°±æœƒæ›´ç†Ÿæ‚‰äº†ï¼åŠ æ²¹ï¼';

    quizScreen.innerHTML = `
        <div class="text-center">
            <h1 class="text-3xl font-bold text-sky-800 mb-4">æ¸¬é©—å®Œæˆï¼</h1>
            <p class="text-lg text-slate-600 mb-2">ä½ çš„æˆç¸¾æ˜¯ï¼š</p>
            <p class="text-6xl font-bold text-slate-800 mb-8">${score} / ${quizQuestions.length}</p>
            <p class="text-base text-slate-500 mb-8">${message}</p>
            <div class="space-y-4 sm:space-y-0 sm:space-x-4">
                <button onclick="initQuiz(vocabulary)" class="w-full sm:w-auto bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 px-8 rounded-full shadow-lg">
                    å®Œæ•´å†è©¦ä¸€æ¬¡
                </button>
                ${incorrectAnswers.length > 0 ? `<button onclick="initQuiz(incorrectAnswers)" class="w-full sm:w-auto bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-8 rounded-full shadow-lg">åªç·´ç¿’éŒ¯é¡Œ (${incorrectAnswers.length})</button>` : ''}
            </div>
        </div>
    `;
}
</script>
</body>
</html>
